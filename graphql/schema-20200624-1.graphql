schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}

# Q U E R I E S
type Query {
  # User
  getUserByUsername(username: String!): User

  # Stream
  getStream(id: ID!): Stream
  listStreamsByUser(first: Int, after: String, userId: ID!): StreamConnection
  listSealedStreams(first: Int, after: String): StreamConnection
  listLiveStreams(first: Int, after: String): StreamConnection
    @aws_auth(cognito_groups: ["tafalk-default-ug"])

  # Cantos
  getCanto(id: ID!): Canto
  listPausedCantos(first: Int, after: String): CantoConnection
  listLiveCantos(first: Int, after: String): CantoConnection
    @aws_auth(cognito_groups: ["tafalk-default-ug"])

  # User interaction
  getUserInteractions(
    interactionType: UserInteractionType
    actorUserId: ID!
    targetUserId: ID!
  ): [UserInteraction] @aws_auth(cognito_groups: ["tafalk-default-ug"])
  listUserInteractionsByActorUserId(
    interactionType: UserInteractionType
    actorUserId: ID!
    limit: Int
    offset: Int
  ): [UserInteraction] @aws_auth(cognito_groups: ["tafalk-default-ug"])

  # Bookmarks
  getContentBookmark(
    id: ID!
  ): ContentInteraction
  countContentBookmarks(contentId: ID!, contentType: ContentType): ResultCount
  countContentBookmarksByUser(
    userId: ID!
    contentType: ContentType
  ): ResultCount
  listContentBookmarks(
    contentId: ID!
    contentType: ContentType
    limit: Int
    offset: Int
  ): [ContentInteraction]
  listContentBookmarksByUser(
    userId: ID!
    contentType: ContentType
    limit: Int
    offset: Int
  ): [ContentInteraction]
  getContentBookmarkByUser(
    userId: ID!
    contentType: ContentType
  ): ContentInteraction


  # Comments
  countContentComments(contentId: ID!, contentType: ContentType): ResultCount
  listContentComments(
    contentId: ID!
    contentType: ContentType
    limit: Int
    offset: Int
  ): [Comment]
  listContentCommentsByUser(
    userId: ID!
    contentType: ContentType
    limit: Int
    offset: Int
  ): [Comment]

  # Flag
  getFlag(
    id: ID!
  ): Flag
  countFlags(searchText: String, status: FlagApprovalStatus): ResultCount
  listFlags(
    limit: Int
    offset: Int
    searchText: String
    status: FlagApprovalStatus
  ): [Flag]
  getFlagByUser(
    flaggerUserId: ID!
    contentType: ContentType
  ): Flag

  # UncloggerPrompt
  listUncloggerPrompts(
    limit: Int
    offset: Int
    searchText: String
    status: UncloggerPromptApprovalStatus
  ): [UncloggerPrompt]
  countUncloggerPrompts(
    searchText: String
    status: UncloggerPromptApprovalStatus
  ): ResultCount
  getRandomUncloggerPrompt(
    category: UncloggerPromptCategory
    language: Language
  ): UncloggerPrompt

  # Search
  search(query: String!): [SearchResult]
    @aws_auth(cognito_groups: ["tafalk-default-ug"])

  # Recaptcha V3 token
  getRecaptchaTokenResult(token: String!, ip: String): RecaptchaV3Result
}

# M U T A T I O N S
type Mutation {
  # User
  updateUser(input: UpdateUserInput!): User
    @aws_auth(cognito_groups: ["tafalk-default-ug"])
  deleteUser(input: DeleteUserInput!): User

  # Stream
  createStream(input: CreateStreamInput!): Stream
    @aws_auth(cognito_groups: ["tafalk-default-ug"])
  updateStream(input: UpdateStreamInput!): Stream
    @aws_auth(cognito_groups: ["tafalk-default-ug"])

  # Canto
  createCanto(input: CreateCantoInput!): Canto
    @aws_auth(cognito_groups: ["tafalk-default-ug"])
  updateCanto(input: UpdateCantoInput!): Canto
    @aws_auth(cognito_groups: ["tafalk-default-ug"])

  # User interaction
  createUserInteraction(input: CreateUserInteractionInput!): UserInteraction
    @aws_auth(cognito_groups: ["tafalk-default-ug"])
  deleteUserInteraction(input: DeleteUserInteractionInput!): UserInteraction
    @aws_auth(cognito_groups: ["tafalk-default-ug"])

  # Content interaction
  createContentInteraction(
    input: CreateContentInteractionInput!
  ): ContentInteraction @aws_auth(cognito_groups: ["tafalk-default-ug"])
  updateContentInteraction(
    input: UpdateContentInteractionInput
  ): ContentInteraction @aws_auth(cognito_groups: ["tafalk-default-ug"])
  deleteContentInteraction(
    input: DeleteContentInteractionInput!
  ): ContentInteraction @aws_auth(cognito_groups: ["tafalk-default-ug"])

  # Comment
  createComment(input: CreateCommentInput!): Comment
    @aws_auth(cognito_groups: ["tafalk-default-ug"])

  # Flag
  createFlag(input: CreateFlagInput!): Flag
    @aws_auth(cognito_groups: ["tafalk-default-ug"])
  updateFlagContent(input: UpdateFlagContentInput): Flag
    @aws_auth(cognito_groups: ["tafalk-default-ug"])
  updateFlagReview(input: UpdateFlagReviewInput): Flag
    @aws_auth(cognito_groups: ["tafalk-admin-ug"])
  deleteFlag(input: DeleteFlagInput!): Flag
    @aws_auth(cognito_groups: ["tafalk-default-ug"])

  # UncloggerPrompt
  createUncloggerPrompt(input: CreateUncloggerPromptInput!): UncloggerPrompt
    @aws_auth(cognito_groups: ["tafalk-default-ug"])
  updateUncloggerPromptContent(
    input: UpdateUncloggerPromptContentInput!
  ): UncloggerPrompt @aws_auth(cognito_groups: ["tafalk-default-ug"])
  updateUncloggerPromptReview(
    input: UpdateUncloggerPromptReviewInput!
  ): UncloggerPrompt @aws_auth(cognito_groups: ["tafalk-admin-ug"])
  deleteUncloggerPrompt(input: DeleteUncloggerPromptInput!): UncloggerPrompt
    @aws_auth(cognito_groups: ["tafalk-default-ug"])
}

# S U B S C R I P T I O N S
type Subscription {
  onUpdateStream(id: ID!): Stream @aws_subscribe(mutations: ["updateStream"])
  onUpdateCanto(id: ID!): Canto @aws_subscribe(mutations: ["updateCanto"])
  onCreateOrDeleteContentInteraction(contentId: String): ContentInteraction
    @aws_subscribe(
      mutations: [
        "createContentInteraction"
        "deleteContentInteraction"
        "updateContentInteraction"
      ]
    )
  onCreateOrDeleteFlag(contentId: String): Flag
    @aws_subscribe(mutations: ["createFlag", "deleteFlag"])
}

# I N T E R F A C E S
interface CommunityReaction {
  id: ID!
  time: String
  userId: String!
}

# U N I O N S
union SearchResult = Stream | Canto | User

# I N P U T S
input UpdateUserInput {
  accountStatus: String
  allowDirectMessages: Boolean
  bio: String
  birthDate: String
  cognitoIdentityId: String
  createdAt: String
  email: String
  fullName: String
  id: ID!
  lastAccess: String
  location: String
  preferredName: String
  language: Language
  profilePictureKey: String
  site: String
  theme: String
  username: String
}

input DeleteUserInput {
  id: ID!
}

input CreateStreamInput {
  body: String!
  id: ID!
  isSealed: Int
  location: String
  mood: [Mood]
  position: [Position]
  privacy: StreamPrivacy!
  sealTime: String
  startTime: String!
  title: String
  track: String
  userId: String!
}

input UpdateStreamInput {
  body: String
  id: ID!
  isSealed: Int
  location: String
  mood: [Mood]
  position: [Position]
  privacy: StreamPrivacy
  sealTime: String
  startTime: String
  title: String
  track: String
}

input CreateCantoInput {
  id: ID!
  body: String
  isPaused: Int
  startTime: String!
  lastUpdateTime: String
}

input UpdateCantoInput {
  id: ID!
  body: String!
  isPaused: Int
  lastUpdateTime: String!
}

input CreateUserInteractionInput {
  actorUserId: String!
  interactionType: UserInteractionType
  targetUserId: String!
}

input DeleteUserInteractionInput {
  id: ID!
}

input CreateContentInteractionInput {
  userId: String!
  interactionType: ContentInteractionType!
  contentType: ContentType!
  contentId: String!
  indices: String
}

input UpdateContentInteractionInput {
  id: ID!
  indices: String!
}

input CreateCommentInput {
  userId: String!
  body: String!
  contentType: ContentType!
  contentId: String!
}

input DeleteContentInteractionInput {
  id: ID!
}

input CreateFlagInput {
  contentType: ContentType!
  contentId: String
  flaggerUserId: String!
  category: String!
  type: String!
  detail: String
}

input UpdateFlagContentInput {
  id: ID!
  category: String
  type: String
  detail: String
}

input UpdateFlagReviewInput {
  id: ID!
  reviewerUserId: String
  status: FlagApprovalStatus
  reviewNote: String
}

input DeleteFlagInput {
  id: ID!
}

input CreateUncloggerPromptInput {
  category: UncloggerPromptCategory!
  body: String!
  language: Language
  creatorUserId: String
}

input UpdateUncloggerPromptContentInput {
  id: ID!
  category: UncloggerPromptCategory
  body: String
  language: Language
}

input UpdateUncloggerPromptReviewInput {
  id: ID!
  reviewerUserId: String
  status: UncloggerPromptApprovalStatus
  reviewNote: String
}

input DeleteUncloggerPromptInput {
  id: ID!
}

# T Y P E S
type User {
  id: ID!
  username: String!
  email: String
  preferredName: String
  accountStatus: String
  allowDirectMessages: Boolean
  theme: String
  bio: String
  birthDate: String!
  cognitoIdentityId: String
  createdAt: String
  lastAccess: String
  location: String
  language: Language
  profilePictureKey: String
  site: String
  canto: Canto
  streams: StreamConnection
  userWatchInteractions: [UserInteraction]
  userBlockInteractions: [UserInteraction]
  committedStreamCommentCount: ResultCount
  committedStreamComments: [Comment]
  bookmarkedStreamCount: ResultCount
  bookmarkedStreams: [Stream]
  bookmarkedCantoCount: ResultCount
  bookmarkedCantos: [Canto]
}

type Stream {
  id: ID!
  title: String
  body: String!
  userId: String!
  user: User
  isSealed: Int
  location: String
  mood: [Mood]
  position: [Position]
  privacy: StreamPrivacy!
  startTime: String!
  sealTime: String
  track: String
  uncloggerPromptId: String
  uncloggerPrompt: UncloggerPrompt
  bookmarkCount: ResultCount
  bookmarks: [ContentInteraction]
  commentCount: ResultCount
  comments: [Comment]
  flagCount: ResultCount
  flags: [Flag]
}

type Canto {
  id: ID!
  body: String!
  user: User
  isPaused: Int
  startTime: String!
  lastUpdateTime: String
  bookmarkCount: ResultCount
  bookmarks: [ContentInteraction]
  flagCount: ResultCount
  flags: [Flag]
}

type UserInteraction {
  id: ID!
  actorUserId: String!
  actorUser: User
  targetUserId: String!
  targetUser: User
  interactionType: UserInteractionType
  lastChangeTime: String!
}

type ContentInteraction implements CommunityReaction {
  id: ID!
  userId: String!
  user: User
  interactionType: ContentInteractionType!
  contentType: ContentType!
  contentId: String!
  indices: String
  time: String
}

type Comment implements CommunityReaction {
  id: ID!
  userId: String!
  user: User
  body: String
  contentType: ContentType!
  contentId: String!
  flagCount: ResultCount
  flags: [Flag]
  time: String
}

type Flag {
  id: ID!
  contentType: ContentType!
  contentId: String
  flaggerUserId: String!
  flaggerUser: User
  category: String!
  type: String!
  detail: String
  reviewerUserId: String
  reviewerUser: User
  status: FlagApprovalStatus
  reviewNote: String
  createTime: String
  reviewTime: String
  lastUpdateTime: String
}

type RecaptchaV3Result {
  challengeTimestamp: String
  errorCodes: [String]
  hostname: String
  success: Boolean
}

type UncloggerPrompt {
  id: ID!
  category: UncloggerPromptCategory!
  body: String!
  language: Language
  status: UncloggerPromptApprovalStatus
  creatorUserId: String
  creatorUser: User
  createTime: String
  reviewerUserId: String
  reviewerUser: User
  reviewNote: String
  reviewTime: String
}

type ResultCount {
  count: Int
}

# C O N N E C T I O N   T Y P E S
type StreamConnection {
  items: [Stream]
  nextToken: String
}

type CantoConnection {
  items: [Canto]
  nextToken: String
}

# E N U M S
enum ContentType {
  stream
  canto
  comment
}

enum Mood {
  Aroused
  AsUsual
  Drunk
  HardToExplain
  High
  Melancholic
  Relieved
}

enum Position {
  AllFours
  Kneeling
  Lying
  Sitting
  Squatting
  Standing
  Walking
}

enum StreamPrivacy {
  Private
  PrivateButWatching
  Protected
  Public
}

enum UncloggerPromptCategory {
  Trivia
  HistoricalEvent
  News
  PhilosophySchools
  Other
}

enum UserInteractionType {
  Block
  Watch
}

enum ContentInteractionType {
  Bookmark
}

enum Language {
  en
  tr
}

enum UncloggerPromptApprovalStatus {
  Pending
  Declined
  Accepted
  OnHold
}

enum FlagApprovalStatus {
  Pending
  Declined
  Accepted
  OnHold
}
